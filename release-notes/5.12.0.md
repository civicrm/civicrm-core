# CiviCRM 5.12.0

Released April 3, 2019

- **[Synopsis](#synopsis)**
- **[Features](#features)**
- **[Bugs resolved](#bugs)**
- **[Miscellany](#misc)**
- **[Credits](#credits)**
- **[Feedback](#feedback)**


## <a name="synopsis"></a>Synopsis

| *Does this version...?*                                         |         |
|:--------------------------------------------------------------- |:-------:|
| Fix security vulnerabilities?                                   |         |
| Change the database schema?                                     | **yes** |
| Alter the API?                                                  | **yes** |
| Require attention to configuration options?                     |         |
| Fix problems installing or upgrading to a previous version?     | **yes** |
| Introduce features?                                             | **yes** |
| Fix bugs?                                                       | **yes** |

## <a name="features"></a>Features

### Core CiviCRM

- **Migrate KAM smartmenus to core
  ([13582](https://github.com/civicrm/civicrm-core/pull/13582),
  [240](https://github.com/civicrm/civicrm-packages/pull/240),
  [13612](https://github.com/civicrm/civicrm-core/pull/13612),
  [13729](https://github.com/civicrm/civicrm-core/pull/13729) and
  [13820](https://github.com/civicrm/civicrm-core/pull/13820))**

  These changes update the CiviCRM Administration menu to use KAM smartmenus
  this makes the menu mobile responsive. Additionally, these changes remove the
  old menu plugin as it is no longer needed, add l10n.js within
  coreResourcesList and fix an unreleased regression for wordpress users where
  the CiviCRM Admin Bar was visible on the 'Front End'
  [dev/core#790](https://lab.civicrm.org/dev/core/issues/790).

- **[dev/core#657](https://lab.civicrm.org/dev/core/issues/657) Add filter for
  country on Repeat Contributions Report
  ([13432](https://github.com/civicrm/civicrm-core/pull/13432))**

  This change adds a filter for Country to the Repeat Contributions Report.

- **[dev/core#690](https://lab.civicrm.org/dev/core/issues/690) Support more
  entities in Attachment API by short-circuiting permission check
  ([13529](https://github.com/civicrm/civicrm-core/pull/13529))**

  This change makes it so one can use the Attachment API to update attachment
  custom fields on Memberships and several other entities.

- **[dev/core#561](https://lab.civicrm.org/dev/core/issues/561) Replace
  jcalendar instances with datepicker
  ([13704](https://github.com/civicrm/civicrm-core/pull/13704),
  [13701](https://github.com/civicrm/civicrm-core/pull/13701) and
  [13746](https://github.com/civicrm/civicrm-core/pull/13746)) Continued Work**

  These changes update the following places to use the datepicker instead of the
  jcalendar widget: the age field on the Advanced Search form in the
  Demographics section, the activity date time field on the find activites form,
  and the date field on the Change Case Type Form. Additionally on the Find
  Activities form these changes make it possible to pass the activity_date_time
  criteria in the url.

- **Add install and runtime status warnings if MySQL utf8mb4 is not supported
  ([13425](https://github.com/civicrm/civicrm-core/pull/13425))**

  This change adds a warning to the system status page, as well as at install
  time, if utf8mb4 is not supported by the stack.

- **Record change log entry when contact is moved to or restored from trash
  ([13276](https://github.com/civicrm/civicrm-core/pull/13276))**

   This change makes it so that a Change Log entry is created when a contact is
   moved to the trash or restored from the trash.

- **Towards supporting EntityForm for 'View Action'
  ([13578](https://github.com/civicrm/civicrm-core/pull/13578))**

  This change enhances support for EntityForm in the "View" context.

- **Standardize format for entityRef create links
  ([13628](https://github.com/civicrm/civicrm-core/pull/13628))**

  This change standardizes entityRef create links so that they are pre-loaded to
  the clientside and so that they work equally well with all entities.

- **Fix (sometimes serious) performance problem on submitting profiles for
  specified contacts
  ([13606](https://github.com/civicrm/civicrm-core/pull/13606))**

  This change improves performance when submitting profiles for specified
  contacts.

- **Add in Exception API to support the refactor of Dedupe Exception Page
  ([13611](https://github.com/civicrm/civicrm-core/pull/13611))**

  This change adds an API to Query Dedupe Exceptions.

- **CRM.loadScript improvements
  ([13555](https://github.com/civicrm/civicrm-core/pull/13555))**

  This change makes it so that dynamically loaded scripts are not served from
  stale browser caches and allows angular apps to dynamically load scripts.

- **Make submitOnce() button js into a button parameter
  ([13333](https://github.com/civicrm/civicrm-core/pull/13333))**

  This change makes it so that developers can set a button as submit only once
  using the parameter `submitOnce = TRUE`.

- **[dev/core#562](https://lab.civicrm.org/dev/core/issues/562) Remove instances
  of $dao->free ([13560](https://github.com/civicrm/civicrm-core/pull/13560) and
  [13564](https://github.com/civicrm/civicrm-core/pull/13564)) Continued Work**

  These changes improve performance by removing instances of $dao->free.

- **[infra/ops#878](https://lab.civicrm.org/infra/ops/issues/878) Add a test
  matrix for E2E tests on each CMS
  ([13808](https://github.com/civicrm/civicrm-core/pull/13808))**

  This change improves reliability by increasing test coverage.

- **Try and add data set example where email_on_hold / on_hold is NULL in the
  formValues ([13765](https://github.com/civicrm/civicrm-core/pull/13765))**

  This change adds test coverage.

- **[dev/core#746](https://lab.civicrm.org/dev/core/issues/746) Search Builder
  searches using > 1 smart group where operator is equals is broken from 5.10.0
  ([13685](https://github.com/civicrm/civicrm-core/pull/13685)) Continued work**

  This change adds test coverage for Search Builder searches using > 1 smart
  group.

- **[dev/report#10](https://lab.civicrm.org/dev/report/issues/10) No pagination
  on Contribution Detail report
  ([13678](https://github.com/civicrm/civicrm-core/pull/13678)) Continued Work**

  This change adds a unit test for pagination on the Contribution Detail report.

- **[dev/core#720](https://lab.civicrm.org/dev/core/issues/720) Performance
  change approved - remove mode & median slow queries
  ([13607](https://github.com/civicrm/civicrm-core/pull/13607),
  [13630](https://github.com/civicrm/civicrm-core/pull/13630) and
  [13605](https://github.com/civicrm/civicrm-core/pull/13605))**

  This change removes the mode and median stats on the contribution search
  summary and contribution tab on contacts to improve performance.

- **[dev/core#748](https://lab.civicrm.org/dev/core/issues/748) Deadlocks and
  performance issues when using smartgroups / ACLs extensively
  ([13732](https://github.com/civicrm/civicrm-core/pull/13732))**

  This change improves performance for smart groups and ACLs.

- **Upgrade Karma version to latest version
  ([13751](https://github.com/civicrm/civicrm-core/pull/13751))**

- **Upgrade PHPWord
  ([13686](https://github.com/civicrm/civicrm-core/pull/13686))**

### CiviContribute

- **Add pseudoconstant for payment_processor_id to contributionrecur
  ([13702](https://github.com/civicrm/civicrm-core/pull/13702)) Continued Work**

  This change alters the schema to add support for payment_processor_id as a
  pseudoconstant for Recurring Contributions.

- **[dev/core#767](https://lab.civicrm.org/dev/core/issues/767) Add 'Cancelled /
  Refunded Date' and 'Cancellation / Refund Reason' in the Detail Contributions
  Report ([13726](https://github.com/civicrm/civicrm-core/pull/13726))**

  This change adds the fields and filters 'Cancelled / Refunded Date' and
  'Cancellation / Refund Reason' to the Detail Contributions Report.

- **[dev/report#8](https://lab.civicrm.org/dev/report/issues/8) Contribution
  reports don't include thank-you date
  ([13653](https://github.com/civicrm/civicrm-core/pull/13653))**

  This change adds the "thank you date" field to the Contribution Summary and
  Detail reports.

- **[dev/core#735](https://lab.civicrm.org/dev/core/issues/735) Query
  performance - suppress 'product' and related fields where products are not in
  the database ([13638](https://github.com/civicrm/civicrm-core/pull/13638))**

  This change removes the "Premium" column from the Contribution tab for sites
  that do not use products and improves performance on those sites by not
  searching for product related fields.

- **Speed up contribution results by removing join on civicrm_financial_type
  table when rendering search results.
  ([13720](https://github.com/civicrm/civicrm-core/pull/13720))**

  This change improves performance when searching contributions.

- **Allow viewing of cancelled recurring contributions
  ([13745](https://github.com/civicrm/civicrm-core/pull/13745))**

  This change makes it possible to view canceled recurring contributions thru
  the user interface.

- **Add new Payment.sendconfirmation api
  ([13610](https://github.com/civicrm/civicrm-core/pull/13610),
  [13561](https://github.com/civicrm/civicrm-core/pull/13561) and
  [13609](https://github.com/civicrm/civicrm-core/pull/13609))**

  These changes add a Payment.sendconfirmation API.

- **Switch additional payment form to use Payment.sendconfirmation api
  ([13649](https://github.com/civicrm/civicrm-core/pull/13649))**

  This change switches the additional payment form to use the new
  Payment.sendconfirmation api.

- **Payment notification formatting, move greeting into table
  ([13669](https://github.com/civicrm/civicrm-core/pull/13669))**

  This change improves the Payment Notification Email formatting by aligning the
  greeting with the table.

- **Update Payment Notification to use greeting, remove text to 'Please print
  this confirmation for your records.
  ([13655](https://github.com/civicrm/civicrm-core/pull/13655))**

  This change improves the Payment Notification email by removing the 'Please
  print this confirmation for your records.' text and switching to use the
  email_greeting instead of the display_name for the greeting.

- **Remove another instance of 'lower'
  ([13636](https://github.com/civicrm/civicrm-core/pull/13636))**

  This change improves performance when searching notes fields on a
  contribution.

- **Contribution/ContributionRecur metadata updates for EntityForm
  ([13579](https://github.com/civicrm/civicrm-core/pull/13579))**

  These changes update the metadata for Contribution and ContributionRecur so
  that they can be used to autogenerate forms with EntityForm.

### CiviMember

- **CiviCRM Membership Detail report, add column to display if membership is
  Primary or Inherited
  ([13736](https://github.com/civicrm/civicrm-core/pull/13736))**

  This change adds a column "Primary/Inherited?" to the Membership Detail
  report.

### Drupal Integration

- **Make address Supplemental line 3 available to views
  ([551](https://github.com/civicrm/civicrm-drupal/pull/551))**

  This change makes it so that one can use the address field "Supplemental
  Address 3" in a view.

### Joomla Integration

- **Improves styling on Joomla! upgrade screen
  ([13557](https://github.com/civicrm/civicrm-core/pull/13557))**

  This change improves the styling of the Joomla upgrade screen.

## <a name="bugs"></a>Bugs resolved

### Core CiviCRM

- **[dev/core#190](https://lab.civicrm.org/dev/core/issues/190) custom data with
  multiple records profile: after submission, profile view shows first record
  instead of most recent
  ([12337](https://github.com/civicrm/civicrm-core/pull/12337))**

  This change ensures when submitting a multi data profile, the most recently
  created record is retrieved on the confirmation page, before this change the
  first record was retrieved.

- **[dev/core#397](https://lab.civicrm.org/dev/core/issues/397) Dedupe for
  Individual Birth Date Results in Error
  ([13538](https://github.com/civicrm/civicrm-core/pull/13538))**

  This change fixes a fatal error when using a dedupe rule with the field birth
  date.

- **[dev/core#580](https://lab.civicrm.org/dev/core/issues/580) No groups
  displayed on Manage Groups when "All Groups" is selected
  ([13373](https://github.com/civicrm/civicrm-core/pull/13373))**

  Before this change if a user had an ACL that gave them permission to Edit
  "All Groups" but did not have the permission "View All Contacts" then on the
  "Manage Groups" screen no groups would appear, this change makes it so that
  groups appear for these users.

- **[dev/core#642](https://lab.civicrm.org/dev/core/issues/642) New Contact
  Report: New report isn't created automatically when the user selects the
  "Create Report" action
  ([13404](https://github.com/civicrm/civicrm-core/pull/13404))**

  This change ensures that when one selects the action "Create Report" on the
  "Constituent Report (Summary)" report a new report is created, before this
  change a js error was thrown and no report was created.

- **[dev/core#683](https://lab.civicrm.org/dev/core/issues/683) Incorrectly
  encoded state and country names
  ([13591](https://github.com/civicrm/civicrm-core/pull/13591))**

  This change ensures that when countries and state/provinces are added they use
  proper character encoding.

- **[dev/core#691](https://lab.civicrm.org/dev/core/issues/691) It is no longer
  possible to have the default country not set
  ([13523](https://github.com/civicrm/civicrm-core/pull/13523))**

  This change makes the default country field on the settings form optional,
  before this change it was required.

- **[dev/core#700](https://lab.civicrm.org/dev/core/issues/700) Advanced Search:
  The reason of failed search result is not displayed, when a contact with the
  matching Contact ID was not found
  ([13549](https://github.com/civicrm/civicrm-core/pull/13549))**

  When using the Advanced Search form to search by contact ID, this change
  ensures if no matching contact is found the Qill states the search criteria
  for which no matches were found.

- **[dev/core#708](https://lab.civicrm.org/dev/core/issues/708) Advanced Search:
  The "Modified By" option was set instead of "Added by"
  ([13566](https://github.com/civicrm/civicrm-core/pull/13566))**

  When using the Advanced Search form to search by "Added by", this change
  ensures if no matching contacts are found the Qill states the search criteria
  for which no matches were found accurately, before this change the qill said
  "No Matches Found Modified by..." instead of "No Matches Found Added by..." .

- **[dev/core#705](https://lab.civicrm.org/dev/core/issues/705) Disabling
  Alphabetical Pager is not respected for events and contribution pages.
  ([13592](https://github.com/civicrm/civicrm-core/pull/13592))**

  This change ensures if in the Admin -> Search preferences "include
  Alphabetical Pager" is turned off, that the A to Z pager is off for Manage
  Events and Manage Contributions.

- **[dev/core#714](https://lab.civicrm.org/dev/core/issues/714) Manage groups:
  Error: "API permission check failed for Group/create call; insufficient
  permission" when the user tries to edit some group's details
  ([13573](https://github.com/civicrm/civicrm-core/pull/13573))**

  This change ensures that on the Manage Groups form, if a user does not have
  permissions to edit a group inline edit is disabled.

- **[dev/core#742](https://lab.civicrm.org/dev/core/issues/742) Repeated
  warning: "simplexml_load_file(): I/O warning : failed to load external entity
  ".../xml/Menu/Activity.xml"
  ([13654](https://github.com/civicrm/civicrm-core/pull/13654))**

  This change fixes warnings regarding failing to parse the XML file when
  clearing the CiviCRM caches.

- **[dev/core#749](https://lab.civicrm.org/dev/core/issues/749) MySQL utf8mb4
  check causes fatal error on some systems
  ([13682](https://github.com/civicrm/civicrm-core/pull/13682))**

  This fixes a bug where on some systems the MySQL utf8mb4 compatibility check
  would cause a fatal error so that an exception is thrown instead of a fatal
  error.

- **[dev/core#769](https://lab.civicrm.org/dev/core/issues/769) ZIP Archive for
  multiple batch exports fail
  ([13728](https://github.com/civicrm/civicrm-core/pull/13728))**

  This change fixes ZIP Archives for multiple batch exports for instances with
  any PHP version greater than 5.6.

- **[dev/report#7](https://lab.civicrm.org/dev/report/issues/7) Transaction Date
  filter in Bookkeeping Transactions report
  ([13571](https://github.com/civicrm/civicrm-core/pull/13571))**

  This change ensures that the trxn_date field on the Bookkeeping Report filter
  respects the times designated in the filter, before this change it would only
  return transactions that occurred at midnight.

- **[dev/report#11](https://lab.civicrm.org/dev/report/issues/11) Soft Credit
  report fails when Only Full Group By is enabled
  ([13671](https://github.com/civicrm/civicrm-core/pull/13671))**

- **Remove mcrypt system status check
  ([13770](https://github.com/civicrm/civicrm-core/pull/13770))**

  This change removes the mcrypt system status check becacuse PHP 7.2 does not
  support mcrypt and it is being deprecated. Before this change the status check
  would respond with the error "mcrypt not present & smtp encryption in place"
  after this change no error is thrown.

- **Fix api bug whereby 0 & '0' are not accepted as range parameters for BETWEEN
  ([13766](https://github.com/civicrm/civicrm-core/pull/13766))**

  This change fixes a bug when using the api and a filter "Between" with one of
  the parameters set to 0 or '0' would result in an error so that one can use a
  between range with 0 as the beginning or the end of the range.

- **Render Note field tokens correctly - they are already HTML.
  ([13283](https://github.com/civicrm/civicrm-core/pull/13283))**

  This change ensures that tokens of Note fields are rendered correctly.

- **Rationalise Activity api ACLs for consistency, to respect the hook & improve
  performance ([13664](https://github.com/civicrm/civicrm-core/pull/13664))**

  This change alters the way permissions are handled on sites that use ACLs when
  the activity.get api is called with the 'check_permissions' flag set to TRUE.
  This would usually be the case for js calls.

- **Fix Custom post outer div class on event registration form
  ([13753](https://github.com/civicrm/civicrm-core/pull/13753))**

  This change updates the class applied to the outer div around a custom profile
  in the post section of the form to use 1 custom_pre-section and 1
  custom_post-section instead of two custom_pre-sections.

- **Upgrader: Don't abort if state_province already exists
  ([13744](https://github.com/civicrm/civicrm-core/pull/13744))**

  This change fixes a fatal error when upgrading from 4.7.30 and 4.7.32 if
  state_province values already exists so that sites with state_province values
  can safely upgrade from 4.7.30 t0 4.7.32.

- **Do not attempt to store out-of-range street number
  ([13340](https://github.com/civicrm/civicrm-core/pull/13340))**

  Before this change attempting to geocode an address with a long street number
  would result in a fatal error "DB Error Out of range value for column
  'street_number'", This change makes it so that for addresses with long street
  numbers address arsing is aborted without a fatal error.

- **geocode job: Do not return more messages than can fit in the log data column
  ([13346](https://github.com/civicrm/civicrm-core/pull/13346))**

  This change fixes an error: "DB Error: Data too long for column 'data' at row
  1" when running the geocoder job on a site with over 500 unparseable
  addresses. This error was being thrown because the message in the job log was
  too big to be saved, this change makes it so that the message is shortened to
  fit in the database.

- **only set custom field to null if it is really null, not string 'null'
  ([13042](https://github.com/civicrm/civicrm-core/pull/13042))**

- **CRM/Logging - Fix various bugs in schema parsing
  ([13441](https://github.com/civicrm/civicrm-core/pull/13441))**

  This change improves logging so that logs return constraints as well as
  indexes (before this change indexes were not returned), and returns column
  lengths without surrounding parenthesis and returns arrays using ['index1',
  'index2'] syntax instead of [0 => ['constraint_name' => 'foo']] syntax.

- **CRM/Logging - Fix log table exceptions
  ([13675](https://github.com/civicrm/civicrm-core/pull/13675))**

  This change ensures that log table exceptions are applied for columns
  regardless of whether or not they have backticks.

- **Fix html2pdf default PDF format when multiple pdf_format are available.
  ([13543](https://github.com/civicrm/civicrm-core/pull/13543))**

  This change ensures that the correct PDF format is selected when multiple pdf
  format options are available.

- **Always load recaptcha JS over HTTPS
  ([13601](https://github.com/civicrm/civicrm-core/pull/13601))**

  This change ensures that recaptcha is loaded regardless of whether the site is
  being served over http or https.

- **If a profile is used to create a contact with a subtype the contact will not
  have any existing subtypes
  ([13499](https://github.com/civicrm/civicrm-core/pull/13499))**

  This change fixes PHP notices being thrown when creating a contact with a
  subtype via a profile.

- **Remove activitystatus js. Add submitOnce handler for activity create
  ([13342](https://github.com/civicrm/civicrm-core/pull/13342))**

  This change makes it so users can only click "save" once when creating an
  activity to prevent users from accidentally creating multiple activities by
  clicking save multiple times.

- **Fix contact ID help on advanced search
  ([13569](https://github.com/civicrm/civicrm-core/pull/13569))**

  This change ensures the help text appears when one clicks the help icon next
  to Contact ID on the Advanced Search form.

- **Used buildoptions function to get all groups
  ([13327](https://github.com/civicrm/civicrm-core/pull/13327))**

  This change fixes a "DB Error: no such field" when using the Contact API to
  get contacts from a group where the group name and group title are different
  so that no error is thrown.

### CiviCase

- **[dev/core#684](https://lab.civicrm.org/dev/core/issues/684) Case Manager not
  updating correctly (CiviCRM 5.8.2)
  ([13528](https://github.com/civicrm/civicrm-core/pull/13528))**

  This change ensures that if the Case Manager is changed on the Manage Case
  screen the "(Case Manager)" tag appears correctly.

- **[dev/core#739](https://lab.civicrm.org/dev/core/issues/739) Field not found
  when sorting report by Case Type as a section header
  ([13666](https://github.com/civicrm/civicrm-core/pull/13666))**

  This change fixes the "Unknown column 'case_civireport.case_type_name' in
  'field list'" error thrown on a Case Detail report sorted by the field Case
  Type with the option "Section Header" checked.

- **[dev/core#770](https://lab.civicrm.org/dev/core/issues/770) View Case
  Activity page displays disabled custom fields
  ([13741](https://github.com/civicrm/civicrm-core/pull/13741))**

  This change ensures that disabled custom fields do not appear on Case
  Activities.

### CiviContribute

- **[dev/core#659](https://lab.civicrm.org/dev/core/issues/659) Civi returning
  500 errors to Paypal Pro request to civicrm/extern/ipn.php
  ([13796](https://github.com/civicrm/civicrm-core/pull/13796))**

  This change ensures that 500 http errors returned from payment processors are
  caught and logged but do not affect the processor response. This fixes a bug
  with Paypal Pro recurring transactions.

- **[dev/core#716](https://lab.civicrm.org/dev/core/issues/716) Add decimals in
  Contribution Amount on Repeat Contributions Report
  ([13659](https://github.com/civicrm/civicrm-core/pull/13659))**

  This change ensures that the Repeat Contributions Report does not truncate the
  decimals of contributions.

- **[dev/core#801](https://lab.civicrm.org/dev/core/issues/801) Thank You
  letters have an invalid 'from' when sending from the contact's email address
  ([13825](https://github.com/civicrm/civicrm-core/pull/13825))**

  This change fixes an error when attempting to send Thank you letters by email.

- **Status of test contribution is not fetched on ThankYou page.
  ([13724](https://github.com/civicrm/civicrm-core/pull/13724))**

  This change ensures that on a Contribution page with a payment processor that
  captures payment instantly and does not use the confirmation page that the
  Confirmation message on the Thank You page states the status of the
  transaction instead of "Your contribution has been submitted...".

- **Move assign of currency for entityForm outside of foreach so order of fields
  don't matter ([13696](https://github.com/civicrm/civicrm-core/pull/13696))**

  This change ensures assign currency works regardless of whether currency is
  before or after the money fields.

- **Find Contributions columns/headers not aligned when "Contributions OR Soft
  Credits?" filter set to "Soft Credits Only"
  ([13517](https://github.com/civicrm/civicrm-core/pull/13517))**

  This change ensures that when running a Find Contributions search with the
  "Contributions OR Soft Credits?" filter set to "Soft Credits Only" the headers
  line up with the correct columns.

### CiviEvent

- **[dev/core#696](https://lab.civicrm.org/dev/core/issues/696) Changes to
  copied event phone and email reflects in original event phone and email
  ([13534](https://github.com/civicrm/civicrm-core/pull/13534))**

  This change fixes a bug where if a user copied an event and then edited the
  copied events email and or phone number, the changes would be applied to the
  original event and the copied event, this change makes it so that the changes
  only apply to the copy.

- **Fix the invocation of post hook for ParticipantPayment ensuring that an id
  is passed in post hook
  ([13739](https://github.com/civicrm/civicrm-core/pull/13739))**

### CiviMail

- **[dev/core#469](https://lab.civicrm.org/dev/core/issues/469) Error on action
  "Email - schedule/send via CiviMail" with multiple event names filter
  ([13539](https://github.com/civicrm/civicrm-core/pull/13539))**

- **CiviMail: Fix reply forwarding for mailers with From: and Return-path:
  limitations ([12641](https://github.com/civicrm/civicrm-core/pull/12641))**

- **"Only variable references should be returned by reference" notice in
  Mail_smtp ([220](https://github.com/civicrm/civicrm-packages/pull/220))**

  This change fixes a "Only variable references should be returned by reference"
  PHP notice under various SMTP error conditions.

### CiviMember

- **[dev/core#631](https://lab.civicrm.org/dev/core/issues/631) Problem when
  merging contacts which have membership records
  ([13588](https://github.com/civicrm/civicrm-core/pull/13588))**

  On the merge screen, when merging Memberships, this change enables the "add
  new" membership checkbox by default if no membership in the main contact
  matches the membership of the other contact so that a new membership is
  created. Before this change if one selected merge memberships but no matching
  membership was found the other contacts Membership was not moved to the main
  contact.

- **[dev/core#644](https://lab.civicrm.org/dev/core/issues/644) "From" address
  on membership renewal notices is wrong
  ([13776](https://github.com/civicrm/civicrm-core/pull/13776))**

  This change ensures that the "From" address on membership renewal notices is
  the display name  of the contact selected in the "Receipt From" field not the
  contact id.

### Drupal Integration

- **fix broken logic in CRM_Utils_System_DrupalBase::formatResourceUrl()
  ([13400](https://github.com/civicrm/civicrm-core/pull/13400))**

  This change fixes a bug where Drupal sites were not processing absolute URLs
  containing the $base_url passed in from extensions (like Shoreditch)
  correctly.

- **[dev/core#381](https://lab.civicrm.org/dev/core/issues/381)
  civicrm/file/imagefile serving up wrong images
  ([564](https://github.com/civicrm/civicrm-drupal/pull/564)) Extends work**

  This change fixes how civicrm/file/imagefiles are served in the Drupal custom
  file field handler file.

### Wordpress Integration

- **[dev/wordpress#18](https://lab.civicrm.org/dev/wordpress/issues/18) wp-cli
  sometimes fails to find cms path
  ([147](https://github.com/civicrm/civicrm-wordpress/pull/147))**

  This change ensures that the path specified to wp-cli as `--path` is passed to
  CiviCRM which fixes some URL errors specifically but not limited to when
  sending bulk mailings with trackable urls.

## <a name="misc"></a>Miscellany

- **Optimize CRM_Core_BAO_FinancialTrxn::getTotalPayment
  ([13187](https://github.com/civicrm/civicrm-core/pull/13187))**

- **Bump minimum upgradable ver to 4.2.9
  ([13580](https://github.com/civicrm/civicrm-core/pull/13580))**

- **Use CRM_Utils_SQL_TempTable to drop and create table.
  ([13688](https://github.com/civicrm/civicrm-core/pull/13688))**

- **Clean up Payment.create function
  ([13690](https://github.com/civicrm/civicrm-core/pull/13690))**

- **[dev/report#9](https://lab.civicrm.org/dev/report/issues/9) Deprecate
  `getBasicContactFields` in favor of `getColumns('Contact')`
  ([13657](https://github.com/civicrm/civicrm-core/pull/13657))**

- **Extract getSearchSQLParts function
  ([13735](https://github.com/civicrm/civicrm-core/pull/13735))**

- **[Test changes] Mailing job test use
  ([13629](https://github.com/civicrm/civicrm-core/pull/13629))**

- **Code cleanup - remove extraneous permissions clause
  ([13645](https://github.com/civicrm/civicrm-core/pull/13645))**

- **Fix typo in comments
  ([13771](https://github.com/civicrm/civicrm-core/pull/13771))**

- **Removes redundant IF
  ([13769](https://github.com/civicrm/civicrm-core/pull/13769))**

- **(NFC) formatting changes
  ([148](https://github.com/civicrm/civicrm-wordpress/pull/148))**

- **report clean up - remove redundant code
  ([13761](https://github.com/civicrm/civicrm-core/pull/13761))**

- **Fix typo and space
  ([13577](https://github.com/civicrm/civicrm-core/pull/13577))**

- **[minor cleanup] reduce params passed to searchQuery
  ([13715](https://github.com/civicrm/civicrm-core/pull/13715))**

- **[TEST FIX] Increase uniqueness in testSingleNowDates
  ([13705](https://github.com/civicrm/civicrm-core/pull/13705))**

- **Revert "[REF] Extract record refund function"
  ([13693](https://github.com/civicrm/civicrm-core/pull/13693))**

- **Minor code cleanup
  ([13687](https://github.com/civicrm/civicrm-core/pull/13687))**

- **[NFC, test class] formatting, remove unused variables
  ([13634](https://github.com/civicrm/civicrm-core/pull/13634))**

- **Authorizenet test - reduce chance of intermittent fails
  ([13642](https://github.com/civicrm/civicrm-core/pull/13642))**

- **[unused code cleanup] Remove unused 'signupType' url support
  ([13620](https://github.com/civicrm/civicrm-core/pull/13620))**

- **[Test support] Add extra output info when getsingle fails as this seems to
  be common  in intermittant fails
  ([13618](https://github.com/civicrm/civicrm-core/pull/13618))**

- **Remove tests that no longer work due to dead service
  ([13617](https://github.com/civicrm/civicrm-core/pull/13617))**

- **Refactor CRM_Utils_SQL_TempTable::build()->createWithQuery($sql) interface
  to support MEMORY tabls
  ([13644](https://github.com/civicrm/civicrm-core/pull/13644))**

- **REF Convert deprecated functions to buildOptions for case
  ([13364](https://github.com/civicrm/civicrm-core/pull/13364))**

- **[REF] Extract record refund function
  ([13691](https://github.com/civicrm/civicrm-core/pull/13691))**

- **[REF] Extract getSearchSQL from getSearchQuery.
  ([13668](https://github.com/civicrm/civicrm-core/pull/13668))**

- **[REF] minor code cleanup - do not build order var just to hurt brains
  ([13650](https://github.com/civicrm/civicrm-core/pull/13650))**

- **[REF] minor cleanup of groupBy definition.
  ([13656](https://github.com/civicrm/civicrm-core/pull/13656))**

- **[REF] extract add median to stats
  ([13616](https://github.com/civicrm/civicrm-core/pull/13616))**

- **[REF] extract cancelled stats to own function
  ([13626](https://github.com/civicrm/civicrm-core/pull/13626))**

- **[REF] Move entityRef filters into their respective BAOs
  ([13625](https://github.com/civicrm/civicrm-core/pull/13625))**

- **[REF] extract basic soft credit stats to separate function
  ([13622](https://github.com/civicrm/civicrm-core/pull/13622))**

- **[REF] Remove unused function parameter
  ([13619](https://github.com/civicrm/civicrm-core/pull/13619))**

- **[REF] Extract lines to add the pseudoconstant to the select
  ([13717](https://github.com/civicrm/civicrm-core/pull/13717))**

- **[REF] extract calculation of mode stat
  ([13614](https://github.com/civicrm/civicrm-core/pull/13614))**

- **[REF] extract calculation of basic stats
  ([13608](https://github.com/civicrm/civicrm-core/pull/13608))**

- **[REF] Move addSelectWhere-like function to be located on BAO_Contribution
  ([13587](https://github.com/civicrm/civicrm-core/pull/13587))**

- **[REF] Fix silly function to do less handling of non-existent scenarios
  ([13563](https://github.com/civicrm/civicrm-core/pull/13563))**

- **[REF] extract chunk of code to a separate function
  ([13600](https://github.com/civicrm/civicrm-core/pull/13600))**

- **[REF} User api rather than selector for rendering contributions on user
  dashboard ([13584](https://github.com/civicrm/civicrm-core/pull/13584))**

- **[REF] switch from (undeclared) class property to local variable.
  ([13583](https://github.com/civicrm/civicrm-core/pull/13583))**

- **[REF] Minor readability cleanup
  ([13562](https://github.com/civicrm/civicrm-core/pull/13562))**

- **[REF] Remove useless class CRM_Report_Form_Event
  ([13632](https://github.com/civicrm/civicrm-core/pull/13632))**

- **[REF] extract getToFinancialAccount from
  CRM_Contribute_PseudoConstantt::contributionStatus
  ([13757](https://github.com/civicrm/civicrm-core/pull/13757))**

- **[ref] Extract activity payment creation
  ([13695](https://github.com/civicrm/civicrm-core/pull/13695))**

- **[REF] separate financial handling & component transitioning in
  Payment.create ([13756](https://github.com/civicrm/civicrm-core/pull/13756))**

- **[REF] towards cleanup of update membership code
  ([13759](https://github.com/civicrm/civicrm-core/pull/13759))**

- **(REF) Rename variables and adjust variable definitions for Event Register
  form ([13287](https://github.com/civicrm/civicrm-core/pull/13287))**

- **[REF] Extract recordPayment portion
  ([13692](https://github.com/civicrm/civicrm-core/pull/13692))**

- **[REF] minor refactor around retrieving processor id for recur
  ([13643](https://github.com/civicrm/civicrm-core/pull/13643))**

- **[code cleanup] Default wrong declared
  ([13621](https://github.com/civicrm/civicrm-core/pull/13621))**

- **[Code cleanup] Remove unused $stationery_path parameter
  ([13624](https://github.com/civicrm/civicrm-core/pull/13624))**

- **Remove long block of commented out code from 4 years ago
  ([13623](https://github.com/civicrm/civicrm-core/pull/13623))**

- **Add unit test on getContributionBalance fn (#13187)
  ([13558](https://github.com/civicrm/civicrm-core/pull/13558))**

- **Phase out CIVICRM_TEMP_FORCE_UTF8
  ([13658](https://github.com/civicrm/civicrm-core/pull/13658))**

- **Extract record refund function
  ([13694](https://github.com/civicrm/civicrm-core/pull/13694))**

- **Move pear/mail from packages to composer.json
  ([13289](https://github.com/civicrm/civicrm-core/pull/13289))**

- **Decommision getPartialPaymentTrxn function
  ([13718](https://github.com/civicrm/civicrm-core/pull/13718))**

- **Fix & test searchQuery order by to be less dependent on what is selected for
  search ([13680](https://github.com/civicrm/civicrm-core/pull/13680))**

- **EntityRef - standardize on PascalCase for entity name and fix minor bug
  ([13631](https://github.com/civicrm/civicrm-core/pull/13631))**

## <a name="credits"></a>Credits

This release was developed by the following code authors:

AGH Strategies - Alice Frumin, Andrew Hunt; Agileware - Alok Patel; Alexy Mikhailichenko; Australian Greens - Seamus Lee; avall-llovera; CiviCRM - Coleman Watts, Tim Otten; CiviDesk - Yashodha Chaku; Coop SymbioTIC - Mathieu Lutfy; Electronic Frontier Foundation - Mark Burdett; Francesc Bassas i Bullich; Fuzion - Jitendra Purohit; GreenPeace Central and Eastern Europe - Patrick Figel; JMA Consulting - Edsel Lopez, Monish Deb; Ken West; Lighthouse Design and Consulting - Brian Shaughnessy; Megaphone Technology Consulting - Jon Goldberg; MJW Consulting - Matthew Wire; Nicol Wistreich; Pradeep Nayak; Skvare - Mark Hanna; Squiffle Consulting - Aidan Saunders; Wikimedia Foundation - Eileen McNaughton

Most authors also reviewed code for this release; in addition, the following
reviewers contributed their comments:

Justin Freeman; Circle Interactive - Dave Jenkins; CiviDesk - Sunil Pawar; Dave D; Fuzion - Peter Davis; JMA Consulting - Joe Murray; Luna Design - Andrew Wasson; MJCO - Mikey O'Toole; mwestergaard; Progressive Technology Project - Jamie McClelland; reecebenson; Richard van Oosterhout; Tadpole Collective - Kevin Cristiano; Third Sector Design - Michael McAndrew

## <a name="feedback"></a>Feedback

These release notes are edited by Alice Frumin and Andrew Hunt.  If you'd like
to provide feedback on them, please log in to https://chat.civicrm.org/civicrm
and contact `@agh1`.
