!function(e){var t=[],i=[],n=activeItem=null,s=e('<div class="menu-div outerbox" style="position:absolute;top:0;left:0;display:none;"><div class="shadowbox1"></div><div class="shadowbox2"></div><div class="shadowbox3"></div></div>')[0],h=e('<ul class="menu-ul innerbox"></ul>')[0],u=e('<li style="position:relative;"><div class="menu-item"></div></li>')[0],o=e('<div id="root-menu-div" style="position:absolute;top:0;left:0;"></div>'),l={showDelay:200,hideDelay:200,hoverOpenDelay:0,offsetTop:0,offsetLeft:0,minWidth:0,onOpen:null,onClose:null,onClick:null,arrowClass:null,addExpando:!1,copyClassAttr:!1};e(function(){o.appendTo("body")}),e.extend({MenuCollection:function(e){this.menus=[],this.init(e)}}),e.extend(e.MenuCollection,{prototype:{init:function(e){if(e&&e.length)for(var t=0;t<e.length;t++)this.addMenu(e[t]),e[t].menuCollection=this},addMenu:function(t){t instanceof e.Menu&&this.menus.push(t),t.menuCollection=this;var i=this;e(t.target).hover(function(){if(!t.visible)for(var e=0;e<i.menus.length;e++)if(i.menus[e].visible)return i.menus[e].hide(),void t.show()},function(){})}}}),e.extend({Menu:function(t,i,n){this.menuItems=[],this.subMenus=[],this.visible=!1,this.active=!1,this.parentMenuItem=null,this.settings=e.extend({},l,n),this.target=t,this.$eDIV=null,this.$eUL=null,this.timer=null,this.menuCollection=null,this.openTimer=null,this.init(),i&&i.constructor==Array&&this.addItems(i)}}),e.extend(e.Menu,{checkMouse:function(t){var n=t.target;if(!i.length||n!=i[0].target){for(;n.parentNode&&n.parentNode!=o[0];)n=n.parentNode;e(i).filter(function(){return this.$eDIV[0]==n}).length||e.Menu.closeAll()}},checkKey:function(t){switch(t.keyCode){case 13:activeItem&&activeItem.click(t,activeItem.$eLI[0]);break;case 27:e.Menu.closeAll();break;case 37:if(n||(n=i[0]),(u=n)&&u.parentMenuItem){var s=u.parentMenuItem;s.$eLI.unbind("mouseout").unbind("mouseover"),u.hide(),s.hoverIn(!0),setTimeout(function(){s.bindHover()})}else if(u&&u.menuCollection){var h=u.menuCollection.menus;(l=e.inArray(u,h))>-1&&(--l<0&&(l=h.length-1),e.Menu.closeAll(),h[l].show(),h[l].setActive(),h[l].menuItems.length&&h[l].menuItems[0].hoverIn(!0))}break;case 38:n&&n.selectNextItem(-1);break;case 39:n||(n=i[0]);var u=n,o=activeItem?activeItem.subMenu:null;if(u)if(o&&o.menuItems.length)o.show(),o.menuItems[0].hoverIn();else if(u=u.inMenuCollection()){var l;h=u.menuCollection.menus;(l=e.inArray(u,h))>-1&&(++l>=h.length&&(l=0),e.Menu.closeAll(),h[l].show(),h[l].setActive(),h[l].menuItems.length&&h[l].menuItems[0].hoverIn(!0))}break;case 40:n?n.selectNextItem():i.length&&i[0].menuItems.length&&i[0].menuItems[0].hoverIn()}if(t.keyCode>36&&t.keyCode<41)return!1},closeAll:function(){for(;i.length;)i[0].hide()},setDefaults:function(t){e.extend(l,t)},prototype:{init:function(){var i=this;this.target&&(this.target instanceof e.MenuItem&&(this.parentMenuItem=this.target,this.target.addSubMenu(this),this.target=this.target.$eLI),t.push(this),this.$eDIV=e(s.cloneNode(1)),this.$eUL=e(h.cloneNode(1)),this.$eDIV[0].appendChild(this.$eUL[0]),o[0].appendChild(this.$eDIV[0]),this.parentMenuItem?this.$eDIV.hover(function(){i.setActive()},function(){}):e(this.target).click(function(e){i.onClick(e)}).hover(function(e){i.setActive(),i.settings.hoverOpenDelay&&(i.openTimer=setTimeout(function(){i.visible||i.onClick(e)},i.settings.hoverOpenDelay))},function(){i.visible||e(this).removeClass("activetarget"),i.openTimer&&clearTimeout(i.openTimer)}))},setActive:function(){this.parentMenuItem?this.active=!0:e(this.target).addClass("activetarget")},addItem:function(t){t instanceof e.MenuItem?-1==e.inArray(t,this.menuItems)&&(this.$eUL.append(t.$eLI),this.menuItems.push(t),t.parentMenu=this,t.subMenu&&this.subMenus.push(t.subMenu)):this.addItem(new e.MenuItem(t,this.settings))},addItems:function(e){for(var t=0;t<e.length;t++)this.addItem(e[t])},removeItem:function(t){var i=e.inArray(t,this.menuItems);i>-1&&this.menuItems.splice(i,1),t.parentMenu=null},hide:function(){if(this.visible){var t,s=e.inArray(this,i);for(this.$eDIV.hide(),s>=0&&i.splice(s,1),this.visible=this.active=!1,e(this.target).removeClass("activetarget"),t=0;t<this.subMenus.length;t++)this.subMenus[t].hide();for(t=0;t<this.menuItems.length;t++)this.menuItems[t].active&&this.menuItems[t].setInactive();i.length||e(document).unbind("mousedown",e.Menu.checkMouse).unbind("keydown",e.Menu.checkKey),n==this&&(n=null),this.settings.onClose&&this.settings.onClose.call(this)}},show:function(t){if(!this.visible){var n,s=this.parentMenuItem;this.menuItems.length&&(s&&(n=parseInt(s.parentMenu.$eDIV.css("z-index")),this.$eDIV.css("z-index",isNaN(n)?1:n+1)),this.$eDIV.css({visibility:"hidden",display:"block"}),this.settings.minWidth&&this.$eDIV.width()<this.settings.minWidth&&this.$eDIV.css("width",this.settings.minWidth),this.setPosition(),this.$eDIV.css({display:"none",visibility:""}).show(),this.settings.onOpen&&this.settings.onOpen.call(this)),0==i.length&&e(document).bind("mousedown",e.Menu.checkMouse).bind("keydown",e.Menu.checkKey),this.visible=!0,i.push(this)}},setPosition:function(){var t,i,n,s,h,u,o,l,r=e(window).width(),a=e(window).height(),c=this.parentMenuItem,d=this.$eDIV[0].clientHeight,m=this.$eDIV[0].clientWidth;c?(n=(i=c.$eLI.offset()).left+c.$eLI.width(),s=i.top):(n=(i=(t=e(this.target)).offset()).left+this.settings.offsetLeft,s=i.top+t.height()+this.settings.offsetTop),e.fn.scrollTop&&(u=e(window).scrollTop(),a<d?s=u:a+u<s+d&&(c?(h=c.parentMenu.$eDIV.offset(),a+u<(s=d<=(l=c.parentMenu.$eDIV[0].clientHeight)?h.top+l-d:h.top)+d&&(s-=s+d-(a+u))):s-=s+d-(a+u))),e.fn.scrollLeft&&r+(o=e(window).scrollLeft())<n+m&&(c?(n-=c.$eLI.width()+m)<o&&(n=o):n-=n+m-(r+o)),this.$eDIV.css({left:n,top:s})},onClick:function(t){this.visible?(this.hide(),this.setActive()):(e.Menu.closeAll(),this.show(t))},addTimer:function(e,t){var i=this;this.timer=setTimeout(function(){e.call(i),i.timer=null},t)},removeTimer:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},selectNextItem:function(e){var t,i=0,n=this.menuItems.length,s=e||1;for(t=0;t<n;t++)if(this.menuItems[t].active){i=t;break}this.menuItems[i].hoverOut();do{(i+=s)>=n?i=0:i<0&&(i=n-1)}while(this.menuItems[i].separator);this.menuItems[i].hoverIn(!0)},inMenuCollection:function(){for(var e=this;e.parentMenuItem;)e=e.parentMenuItem.parentMenu;return e.menuCollection?e:null},destroy:function(){var i;for(this.hide(),this.parentMenuItem?this.$eDIV.unbind("mouseover").unbind("mouseout"):e(this.target).unbind("click").unbind("mouseover").unbind("mouseout");this.menuItems.length;)this.menuItems[0].destroy(),0;(i=e.inArray(this,t))>-1&&t.splice(i,1),this.menuCollection&&(i=e.inArray(this,this.menuCollection.menus))>-1&&this.menuCollection.menus.splice(i,1),this.$eDIV.remove()}}}),e.extend({MenuItem:function(t,i){"string"==typeof t&&(t={src:t}),this.src=t.src||"",this.url=t.url||null,this.urlTarget=t.target||null,this.addClass=t.addClass||null,this.data=t.data||null,this.$eLI=null,this.parentMenu=null,this.subMenu=null,this.settings=e.extend({},l,i),this.active=!1,this.enabled=!0,this.separator=!1,this.init(),t.subMenu&&new e.Menu(this,t.subMenu,i)}}),e.extend(e.MenuItem,{prototype:{init:function(){var t,i,n=this.src,s=this;if(this.$eLI=e(u.cloneNode(1)),this.addClass&&this.$eLI[0].setAttribute("class",this.addClass),this.settings.addExpando&&this.data&&(this.$eLI[0].menuData=this.data),""==n)this.$eLI.addClass("menu-separator"),this.separator=!0;else for((i="string"==typeof n)&&this.url?n=e('<a href="'+this.url+'"'+(this.urlTarget?'target="'+this.urlTarget+'"':"")+">"+n+"</a>"):!i&&n.length||(n=[n]),t=0;t<n.length;t++)"string"==typeof n[t]?(elem=document.createElement("span"),elem.innerHTML=n[t],this.$eLI[0].firstChild.appendChild(elem)):this.$eLI[0].firstChild.appendChild(n[t].cloneNode(1));this.$eLI.click(function(e){s.click(e,this)}),this.bindHover()},click:function(e,t){this.enabled&&this.settings.onClick&&this.settings.onClick.call(t,e,this)},bindHover:function(){var e=this;this.$eLI.hover(function(){e.hoverIn()},function(){e.hoverOut()})},hoverIn:function(e){this.removeTimer();var t,i=this.parentMenu.subMenus,s=this.parentMenu.menuItems;if(this.parentMenu.timer&&this.parentMenu.removeTimer(),this.enabled){for(t=0;t<s.length;t++)s[t].active&&s[t].setInactive();for(this.setActive(),n=this.parentMenu,t=0;t<i.length;t++)i[t].visible&&i[t]!=this.subMenu&&!i[t].timer&&i[t].addTimer(function(){this.hide()},i[t].settings.hideDelay);this.subMenu&&!e&&this.subMenu.addTimer(function(){this.show()},this.subMenu.settings.showDelay)}},hoverOut:function(){this.removeTimer(),this.enabled&&(this.subMenu&&this.subMenu.visible||this.setInactive())},removeTimer:function(){this.subMenu&&this.subMenu.removeTimer()},setActive:function(){this.active=!0,this.$eLI.addClass("active");var e=this.parentMenu.parentMenuItem;e&&!e.active&&e.setActive(),activeItem=this},setInactive:function(){this.active=!1,this.$eLI.removeClass("active"),this==activeItem&&(activeItem=null)},enable:function(){this.$eLI.removeClass("disabled"),this.enabled=!0},disable:function(){this.$eLI.addClass("disabled"),this.enabled=!1},destroy:function(){this.removeTimer(),this.$eLI.remove(),this.$eLI.unbind("mouseover").unbind("mouseout").unbind("click"),this.subMenu&&(this.subMenu.destroy(),delete this.subMenu),this.parentMenu.removeItem(this)},addSubMenu:function(t){if(!this.subMenu&&(this.subMenu=t,this.parentMenu&&-1==e.inArray(t,this.parentMenu.subMenus)&&this.parentMenu.subMenus.push(t),this.settings.arrowClass)){var i=e('<i class="menu-item-arrow"></i>').addClass(this.settings.arrowClass);this.$eLI[0].firstChild.appendChild(i[0])}}}}),e.extend(e.fn,{menuFromElement:function(t,i,n){var s=function(i){var n,h,u,o,l,c,d,m=[],f=null;for(u=a(i,"LI"),l=0;l<u.length;l++)n=[],u[l].childNodes.length?((c=r(u[l],"UL"))&&(n=s(c),e(c).remove()),d=1==(o=e(u[l]))[0].childNodes.length&&3==o[0].childNodes[0].nodeType?o[0].childNodes[0].nodeValue:o[0].childNodes,t&&t.copyClassAttr&&(f=o.attr("class")),h=new e.MenuItem({src:d,addClass:f},t),m.push(h),n.length&&new e.Menu(h,n,t)):m.push(new e.MenuItem("",t));return m};return this.each(function(){var h,u;(i||(h=r(this,"UL")))&&(h=i?e(i).clone(!0)[0]:h,menuItems=s(h),menuItems.length&&(u=new e.Menu(this,menuItems,t),n&&n.addMenu(u)),e(h).hide())})},menuBarFromUL:function(t){return this.each(function(){var i,n=a(this,"LI");if(n.length)for(bar=new e.MenuCollection,i=0;i<n.length;i++)e(n[i]).menuFromElement(t,null,bar)})},menuBar:function(t,i){return this.each(function(){i&&i.constructor==Array?new e.Menu(this,i,t):"UL"==this.nodeName.toUpperCase()?e(this).menuBarFromUL(t):e(this).menuFromElement(t,i)})}});var r=function(e,t){if(!e)return null;for(var i=e.firstChild;i;i=i.nextSibling)if(1==i.nodeType&&i.nodeName.toUpperCase()==t)return i;return null},a=function(e,t){if(!e)return[];for(var i=[],n=e.firstChild;n;n=n.nextSibling)1==n.nodeType&&n.nodeName.toUpperCase()==t&&(i[i.length]=n);return i}}(jQuery);