<?php
declare(strict_types = 1);

use CRM_RouterTest_ExtensionUtil as E;
use Civi\Test\EndToEndInterface;

/**
 * @group e2e
 */
class CRM_RouterTest_Page_PageWithPsr7Test extends \PHPUnit\Framework\TestCase implements EndToEndInterface {

  use \Civi\Test\HttpTestTrait;

  public static function setUpBeforeClass(): void {
    \Civi\Test::e2e()->installMe(__DIR__)->apply();
  }

  /**
   * @see \CRM_RouterTest_Page_PageWithPsr7::run()
   */
  public function testGet(): void {
    $client = $this->createGuzzle([
      'authx_user' => $GLOBALS['_CV']['ADMIN_USER'],
      'authx_ttl' => 30 * 60,
    ]);
    $result = $client->request('GET', 'frontend://civicrm/route-test/page-with-psr7');
    $this->assertContentType('text/html', $result);
    $this->assertBodyRegexp(';This page is generated by CRM/RouterTest/Page/PageWithPsr7;', $result);
  }

}
